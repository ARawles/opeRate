<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3.5 Mutating | opeRate</title>
  <meta name="description" content="Apply your knowledge of the R programming language to real problems and tasks." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="3.5 Mutating | opeRate" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="cover.png" />
  <meta property="og:description" content="Apply your knowledge of the R programming language to real problems and tasks." />
  <meta name="github-repo" content="ARawles/opeRate" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3.5 Mutating | opeRate" />
  
  <meta name="twitter:description" content="Apply your knowledge of the R programming language to real problems and tasks." />
  <meta name="twitter:image" content="cover.png" />

<meta name="author" content="Adam Rawles" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<link rel="prev" href="grouping.html"/>
<link rel="next" href="summarising.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> opeRate</a>
<ul>
<li class="chapter" data-level="1.1" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i><b>1.1</b> Overview</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="overview.html"><a href="overview.html#acknowledgements"><i class="fa fa-check"></i><b>1.1.1</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="about-me.html"><a href="about-me.html"><i class="fa fa-check"></i><b>1.2</b> About Me</a></li>
<li class="chapter" data-level="1.3" data-path="using-r.html"><a href="using-r.html"><i class="fa fa-check"></i><b>1.3</b> Using R</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="tidyverse.html"><a href="tidyverse.html"><i class="fa fa-check"></i><b>2</b> tidyverse</a>
<ul>
<li class="chapter" data-level="2.1" data-path="tidy-data.html"><a href="tidy-data.html"><i class="fa fa-check"></i><b>2.1</b> “Tidy” data</a></li>
<li class="chapter" data-level="2.2" data-path="the-pipe.html"><a href="the-pipe.html"><i class="fa fa-check"></i><b>2.2</b> The pipe <code>%&gt;%</code></a></li>
<li class="chapter" data-level="2.3" data-path="quasiquotation.html"><a href="quasiquotation.html"><i class="fa fa-check"></i><b>2.3</b> Quasiquotation</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="quasiquotation.html"><a href="quasiquotation.html#tidyselect"><i class="fa fa-check"></i><b>2.3.1</b> tidyselect</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-analysis.html"><a href="data-analysis.html"><i class="fa fa-check"></i><b>3</b> Data Analysis</a>
<ul>
<li class="chapter" data-level="3.1" data-path="loading.html"><a href="loading.html"><i class="fa fa-check"></i><b>3.1</b> Loading</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="loading.html"><a href="loading.html#rds"><i class="fa fa-check"></i><b>3.1.1</b> RDS</a></li>
<li class="chapter" data-level="3.1.2" data-path="loading.html"><a href="loading.html#csv"><i class="fa fa-check"></i><b>3.1.2</b> CSV</a></li>
<li class="chapter" data-level="3.1.3" data-path="loading.html"><a href="loading.html#excel-files"><i class="fa fa-check"></i><b>3.1.3</b> Excel files</a></li>
<li class="chapter" data-level="3.1.4" data-path="loading.html"><a href="loading.html#web-based-apis"><i class="fa fa-check"></i><b>3.1.4</b> Web-based APIs</a></li>
<li class="chapter" data-level="3.1.5" data-path="loading.html"><a href="loading.html#databases"><i class="fa fa-check"></i><b>3.1.5</b> Databases</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="cleaning.html"><a href="cleaning.html"><i class="fa fa-check"></i><b>3.2</b> Cleaning</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="cleaning.html"><a href="cleaning.html#filtering"><i class="fa fa-check"></i><b>3.2.1</b> Filtering</a></li>
<li class="chapter" data-level="3.2.2" data-path="cleaning.html"><a href="cleaning.html#missing-values"><i class="fa fa-check"></i><b>3.2.2</b> Missing values</a></li>
<li class="chapter" data-level="3.2.3" data-path="cleaning.html"><a href="cleaning.html#changing-column-types"><i class="fa fa-check"></i><b>3.2.3</b> Changing column types</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="tidying.html"><a href="tidying.html"><i class="fa fa-check"></i><b>3.3</b> Tidying</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="tidying.html"><a href="tidying.html#pivoting-columns"><i class="fa fa-check"></i><b>3.3.1</b> Pivoting columns</a></li>
<li class="chapter" data-level="3.3.2" data-path="tidying.html"><a href="tidying.html#pivoting-columns-to-rows-longer"><i class="fa fa-check"></i><b>3.3.2</b> Pivoting columns to rows (longer)</a></li>
<li class="chapter" data-level="3.3.3" data-path="tidying.html"><a href="tidying.html#pivoting-rows-to-columns-wider"><i class="fa fa-check"></i><b>3.3.3</b> Pivoting rows to columns (wider)</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="grouping.html"><a href="grouping.html"><i class="fa fa-check"></i><b>3.4</b> Grouping</a></li>
<li class="chapter" data-level="3.5" data-path="mutating.html"><a href="mutating.html"><i class="fa fa-check"></i><b>3.5</b> Mutating</a></li>
<li class="chapter" data-level="3.6" data-path="summarising.html"><a href="summarising.html"><i class="fa fa-check"></i><b>3.6</b> Summarising</a></li>
<li class="chapter" data-level="3.7" data-path="plotting.html"><a href="plotting.html"><i class="fa fa-check"></i><b>3.7</b> Plotting</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="plotting.html"><a href="plotting.html#ggplot2"><i class="fa fa-check"></i><b>3.7.1</b> ggplot2</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="modelling.html"><a href="modelling.html"><i class="fa fa-check"></i><b>3.8</b> Modelling</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="projects.html"><a href="projects.html"><i class="fa fa-check"></i><b>4</b> Projects</a>
<ul>
<li class="chapter" data-level="4.1" data-path="workflows.html"><a href="workflows.html"><i class="fa fa-check"></i><b>4.1</b> Workflows</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="workflows.html"><a href="workflows.html#basic-workflow"><i class="fa fa-check"></i><b>4.1.1</b> Basic Workflow</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="replicability.html"><a href="replicability.html"><i class="fa fa-check"></i><b>4.2</b> Replicability</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="replicability.html"><a href="replicability.html#good-practice"><i class="fa fa-check"></i><b>4.2.1</b> Good practice</a></li>
<li class="chapter" data-level="4.2.2" data-path="replicability.html"><a href="replicability.html#documentation"><i class="fa fa-check"></i><b>4.2.2</b> Documentation</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="projects-as-packages.html"><a href="projects-as-packages.html"><i class="fa fa-check"></i><b>4.3</b> Projects as Packages</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="projects-as-packages.html"><a href="projects-as-packages.html#structure"><i class="fa fa-check"></i><b>4.3.1</b> Structure</a></li>
<li class="chapter" data-level="4.3.2" data-path="projects-as-packages.html"><a href="projects-as-packages.html#documentation-1"><i class="fa fa-check"></i><b>4.3.2</b> Documentation</a></li>
<li class="chapter" data-level="4.3.3" data-path="projects-as-packages.html"><a href="projects-as-packages.html#description"><i class="fa fa-check"></i><b>4.3.3</b> DESCRIPTION</a></li>
<li class="chapter" data-level="4.3.4" data-path="projects-as-packages.html"><a href="projects-as-packages.html#abstraction"><i class="fa fa-check"></i><b>4.3.4</b> Abstraction</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="git-github.html"><a href="git-github.html"><i class="fa fa-check"></i><b>4.4</b> Git &amp; GitHub</a></li>
<li class="chapter" data-level="4.5" data-path="example.html"><a href="example.html"><i class="fa fa-check"></i><b>4.5</b> Example</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">opeRate</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="mutating" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> Mutating</h2>
<p>Sometimes you’ll want to add new columns to your data. Most of the time, these will be calculated columns that can be created based on one or more of the other columns in the dataset. To create new columns, we use the <code>dplyr::mutate()</code> function.</p>
<p>First off, let’s add something simple; a column that calculates the proportion of EU sales compared to global sales. All we need to do is provide the name of our new column to the <code>dplyr::mutate()</code> function and how our new column should be calculated:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="mutating.html#cb97-1" aria-hidden="true" tabindex="-1"></a>clean_vg_sales <span class="sc">%&gt;%</span></span>
<span id="cb97-2"><a href="mutating.html#cb97-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">EU_Proportion =</span> EU_Sales<span class="sc">/</span>Global_Sales) <span class="sc">%&gt;%</span></span>
<span id="cb97-3"><a href="mutating.html#cb97-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Rank, Name, Platform, Year, Genre, Publisher, EU_Proportion) <span class="sc">%&gt;%</span></span>
<span id="cb97-4"><a href="mutating.html#cb97-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## # A tibble: 16,327 x 7
##    Rank Name                   Platform  Year Genre      Publisher EU_Proportion
##   &lt;dbl&gt; &lt;chr&gt;                  &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;             &lt;dbl&gt;
## 1     1 Wii Sports             Wii       2006 Sports     Nintendo         0.351 
## 2     2 Super Mario Bros.      NES       1985 Platform   Nintendo         0.0890
## 3     3 Mario Kart Wii         Wii       2008 Racing     Nintendo         0.360 
## 4     4 Wii Sports Resort      Wii       2009 Sports     Nintendo         0.334 
## 5     5 Pokemon Red/Pokemon B… GB        1996 Role-Play… Nintendo         0.283 
## # … with 16,322 more rows</code></pre>
<p>As you can see, we’ve created a new column called <code>EU_Proportion</code> and we’ve calculated by dividing the number of EU sales by the total number of sales.</p>
<p>While this is certainly a powerful tool, we’re not really changing the world here. However, we can create more complicated columns by leveraging the concept of applying our function to <a href="grouping.html#grouping">groups</a>.</p>
<p>When our dataset is grouped, our <code>mutate()</code> call will be evaluated for each permutation of the provided groups. Let’s look at an example of creating a cumulative sum for each Publisher:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="mutating.html#cb99-1" aria-hidden="true" tabindex="-1"></a>clean_vg_sales <span class="sc">%&gt;%</span></span>
<span id="cb99-2"><a href="mutating.html#cb99-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(Publisher) <span class="sc">%&gt;%</span></span>
<span id="cb99-3"><a href="mutating.html#cb99-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">as.numeric</span>(Year)) <span class="sc">%&gt;%</span> <span class="co"># We need to order from earliest date to latest</span></span>
<span id="cb99-4"><a href="mutating.html#cb99-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Cumulative_Sales =</span> <span class="fu">cumsum</span>(Global_Sales)) <span class="sc">%&gt;%</span></span>
<span id="cb99-5"><a href="mutating.html#cb99-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Publisher <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Atari&quot;</span>, <span class="st">&quot;Activision&quot;</span>)) <span class="sc">%&gt;%</span> <span class="co"># Let&#39;s just look at Atari &amp; Activision</span></span>
<span id="cb99-6"><a href="mutating.html#cb99-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1,313 x 12
## # Groups:   Publisher [2]
##    Rank Name  Platform  Year Genre Publisher NA_Sales EU_Sales JP_Sales
##   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;        &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1   259 Aste… 2600      1980 Shoo… Atari         4        0.26        0
## 2   545 Miss… 2600      1980 Shoo… Atari         2.56     0.17        0
## 3  1768 Kabo… 2600      1980 Misc  Activisi…     1.07     0.07        0
## 4  1971 Defe… 2600      1980 Misc  Atari         0.99     0.05        0
## 5  2671 Boxi… 2600      1980 Figh… Activisi…     0.72     0.04        0
## # … with 1,308 more rows, and 3 more variables: Other_Sales &lt;dbl&gt;,
## #   Global_Sales &lt;dbl&gt;, Cumulative_Sales &lt;dbl&gt;</code></pre>
<p>Now we’ve got a new column showing the total number of sales for each Publisher up to each year. What <code>{dplyr}</code> has done is essentially filtered the data down a specific publisher, created a cumulative sum of the <code>Global_Sales</code> column, and then done that for each publisher and stitched it back together.</p>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="grouping.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="summarising.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
